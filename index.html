<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CodeHub â€” self-contained (fixed)</title>
<style>
/* ê°„ê²°í•˜ê³  ì•ˆì •ì ì¸ UI ìŠ¤íƒ€ì¼ */
*{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#0d1117;--panel:#161b22;--muted:#8b949e;--accent:#1f6feb;--text:#e6edf3}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Inter,system-ui,Arial;background:var(--bg);color:var(--text);height:100vh;overflow:hidden}
.header{background:var(--panel);border-bottom:1px solid #30363d;padding:12px 18px;display:flex;align-items:center;justify-content:space-between}
.logo{display:flex;align-items:center;gap:10px;font-weight:700}
.logo-icon{width:34px;height:34px;border-radius:6px;background:linear-gradient(135deg,#7c3aed,#3b82f6);display:flex;align-items:center;justify-content:center}
.header-actions{display:flex;gap:8px}
.btn{background:#21262d;border:1px solid #30363d;color:var(--text);padding:6px 12px;border-radius:6px;cursor:pointer}
.btn:hover{background:#30363d}
.btn-primary{background:#238636;border-color:#238636;color:#fff}
.main-container{display:flex;height:calc(100vh - 60px)}
.sidebar{width:280px;background:var(--bg);border-right:1px solid #30363d;display:flex;flex-direction:column}
.file-explorer{padding:14px;border-bottom:1px solid #30363d}
.explorer-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;font-weight:600}
.file-list{list-style:none;max-height:220px;overflow:auto}
.file-item{padding:8px;border-radius:6px;cursor:pointer;display:flex;gap:8px;align-items:center}
.file-item:hover{background:#21262d}
.file-item.active{background:var(--accent);color:#fff}
.templates{padding:14px;flex:1;overflow:auto}
.template-item{padding:10px;background:var(--panel);border-radius:8px;margin-bottom:8px;cursor:pointer}
.template-item:hover{background:#1f2430}
.editor-container{flex:1;display:flex;flex-direction:column}
.tabs{background:var(--panel);border-bottom:1px solid #30363d;display:flex;align-items:center;padding:6px 10px}
.tab{padding:8px 12px;border-radius:6px;background:transparent;color:var(--muted);cursor:pointer;margin-right:6px}
.tab.active{background:var(--bg);color:var(--text);border-bottom:2px solid var(--accent)}
.editor-panes{flex:1;display:flex;min-height:0}
.editor-pane{flex:1;display:none;flex-direction:column;min-height:0}
.editor-pane.active{display:flex}
.editor-with-numbers{display:flex;flex:1;min-height:0}
.line-numbers{background:var(--bg);color:#6e7681;padding:14px 8px;font-family:'JetBrains Mono',monospace;font-size:13px;line-height:1.5;text-align:right;border-right:1px solid #21262d;min-width:46px;overflow:auto}
.code-editor{flex:1;background:var(--bg);color:var(--text);font-family:'JetBrains Mono',monospace;font-size:13px;padding:14px;border:none;outline:none;resize:none;tab-size:2;min-height:0}
.preview-container{width:46%;background:#fff;border-left:1px solid #30363d;display:flex;flex-direction:column}
.preview-header{background:#f6f8fa;border-bottom:1px solid #d0d7de;padding:10px 12px;display:flex;justify-content:space-between;align-items:center}
.preview-actions{display:flex;gap:8px}
.preview-btn{background:#fff;border:1px solid #d0d7de;padding:6px 10px;border-radius:6px;cursor:pointer}
.preview-frame{flex:1;border:none;background:#fff}
.status-bar{background:var(--panel);border-top:1px solid #30363d;padding:6px 12px;font-size:12px;color:var(--muted);display:flex;justify-content:space-between;align-items:center}
@media(max-width:960px){.preview-container{display:none}.sidebar{width:220px}.main-container{flex-direction:column}}
</style>
</head>
<body>
  <div class="header">
    <div class="logo"><div class="logo-icon">âš¡</div>CodeHub</div>
    <div class="header-actions">
      <button class="btn" onclick="saveProject()">ğŸ’¾ ì €ì¥</button>
      <button class="btn" onclick="shareProject()">ğŸ”— ê³µìœ </button>
      <button class="btn btn-primary" onclick="runCode()">â–¶ï¸ ì‹¤í–‰</button>
    </div>
  </div>

  <div class="main-container">
    <div class="sidebar">
      <div class="file-explorer">
        <div class="explorer-title">
          íŒŒì¼ íƒìƒ‰ê¸°
          <button class="btn" style="padding:4px 8px;font-size:13px" onclick="addNewFile()">+</button>
        </div>
        <ul class="file-list" id="fileList">
          <li class="file-item active" data-file="html"><span>ğŸŒ</span> index.html</li>
          <li class="file-item" data-file="css"><span>ğŸ¨</span> style.css</li>
          <li class="file-item" data-file="js"><span>âš¡</span> script.js</li>
        </ul>
      </div>

      <div class="templates">
        <div style="font-weight:700;margin-bottom:8px">í…œí”Œë¦¿</div>
        <div class="template-item" onclick="loadTemplate('basic')"><div style="font-weight:600">ê¸°ë³¸ ì›¹í˜ì´ì§€</div><div style="color:var(--muted)">HTML/CSS/JS ê¸°ë³¸</div></div>
        <div class="template-item" onclick="loadTemplate('portfolio')"><div style="font-weight:600">í¬íŠ¸í´ë¦¬ì˜¤</div><div style="color:var(--muted)">í¬íŠ¸í´ë¦¬ì˜¤ í…œí”Œë¦¿</div></div>
        <div class="template-item" onclick="loadTemplate('game')"><div style="font-weight:600">ê°„ë‹¨ ê²Œì„</div><div style="color:var(--muted)">ìº”ë²„ìŠ¤ ìƒ˜í”Œ</div></div>
      </div>
    </div>

    <div class="editor-container">
      <div class="tabs">
        <button class="tab active" data-tab="html">ğŸŒ HTML</button>
        <button class="tab" data-tab="css">ğŸ¨ CSS</button>
        <button class="tab" data-tab="js">âš¡ JS</button>
      </div>

      <div class="editor-panes">
        <div class="editor-pane active" id="htmlPane">
          <div class="editor-with-numbers">
            <div class="line-numbers" id="htmlLineNumbers">1</div>
            <textarea class="code-editor" id="htmlEditor" spellcheck="false"><!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë‚´ ì›¹ì‚¬ì´íŠ¸</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹</h1>
    <p>ì—¬ê¸°ì„œ ë©‹ì§„ ì›¹ì‚¬ì´íŠ¸ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>
    <button onclick="sayHello()">í´ë¦­í•´ë³´ì„¸ìš”</button>
  </div>
  <script src="script.js"></script>
</body>
</html></textarea>
          </div>
        </div>

        <div class="editor-pane" id="cssPane">
          <div class="editor-with-numbers">
            <div class="line-numbers" id="cssLineNumbers">1</div>
            <textarea class="code-editor" id="cssEditor" spellcheck="false">body{font-family:Arial,sans-serif;margin:0;padding:0;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center}.container{background:#fff;padding:40px;border-radius:16px;box-shadow:0 20px 40px rgba(0,0,0,0.08);text-align:center}h1{margin-bottom:20px;color:#222}p{color:#555;margin-bottom:20px}button{background:#667eea;color:#fff;border:none;padding:12px 24px;border-radius:12px;cursor:pointer}</textarea>
          </div>
        </div>

        <div class="editor-pane" id="jsPane">
          <div class="editor-with-numbers">
            <div class="line-numbers" id="jsLineNumbers">1</div>
            <textarea class="code-editor" id="jsEditor" spellcheck="false">function sayHello(){ alert('ì•ˆë…•í•˜ì„¸ìš”! CodeHubì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤! ğŸ‰'); const btn=document.querySelector('.container button'); if(btn) btn.textContent='ë‹¤ì‹œ í´ë¦­í•´ë³´ì„¸ìš” âœ¨'; document.body.style.background='linear-gradient(135deg,#f093fb 0%,#f5576c 100%)' } document.addEventListener('DOMContentLoaded',()=>console.log('CodeHub ready'))</textarea>
          </div>
        </div>
      </div>
    </div>

    <div class="preview-container">
      <div class="preview-header">
        <div class="preview-title">ë¯¸ë¦¬ë³´ê¸°</div>
        <div class="preview-actions">
          <button class="preview-btn" onclick="refreshPreview()">ğŸ”„</button>
          <button class="preview-btn" onclick="openInNewTab()">ìƒˆ íƒ­ì—ì„œ ì—´ê¸°</button>
        </div>
      </div>
      <!-- sandbox: allow-scripts ë§Œ ì£¼ì–´ ìœ„í—˜ ìµœì†Œí™” -->
      <iframe id="previewFrame" class="preview-frame" sandbox="allow-scripts"></iframe>
    </div>
  </div>

  <div class="status-bar">
    <div>ì¤€ë¹„ë¨ âœ…</div>
    <div id="statusInfo">HTML | ë¼ì¸ 1</div>
  </div>

<script>
/* ===== ìœ í‹¸: base64 (UTF-8 safe) ===== */
function base64EncodeUnicode(str){ return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,(m,p)=>String.fromCharCode('0x'+p))); }
function base64DecodeUnicode(str){ return decodeURIComponent(Array.prototype.map.call(atob(str),c=>'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2)).join('')); }

/* ===== ìƒíƒœ ì´ˆê¸°ê°’ ===== */
let currentFile = 'html';
let files = {
  html: document.getElementById('htmlEditor').value,
  css: document.getElementById('cssEditor').value,
  js: document.getElementById('jsEditor').value
};

/* ===== ë¼ì¸ ë²ˆí˜¸ ì—…ë°ì´íŠ¸ ===== */
function updateLineNumbers(fileType){
  const ed = document.getElementById(fileType + 'Editor');
  const ln = document.getElementById(fileType + 'LineNumbers');
  const lines = Math.max(1, ed.value.split('\n').length);
  let out = '';
  for(let i=1;i<=lines;i++) out += i + '\n';
  ln.textContent = out;
}

/* ===== íƒ­/íŒŒì¼ í´ë¦­ ë°”ì¸ë”© ===== */
document.querySelectorAll('.tab').forEach(t => t.addEventListener('click', ()=> switchTab(t.dataset.tab)));
document.querySelectorAll('.file-item').forEach(it => it.addEventListener('click', ()=>{
  document.querySelectorAll('.file-item').forEach(f=>f.classList.remove('active'));
  it.classList.add('active');
  switchTab(it.dataset.file);
}));

/* ===== ì—ë””í„° ì´ë²¤íŠ¸ ===== */
['html','css','js'].forEach(type=>{
  const ed = document.getElementById(type + 'Editor');
  ed.addEventListener('input', ()=>{
    files[type] = ed.value;
    updateLineNumbers(type);
    updateStatus();
    clearTimeout(window.previewTimeout);
    window.previewTimeout = setTimeout(updatePreview, 420);
  });
  ed.addEventListener('scroll', ()=> document.getElementById(type + 'LineNumbers').scrollTop = ed.scrollTop);
});

/* ===== íƒ­ ì „í™˜ ===== */
function switchTab(tabType){
  saveCurrentFile();
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelector(`[data-tab="${tabType}"]`).classList.add('active');
  document.querySelectorAll('.editor-pane').forEach(p=>p.classList.remove('active'));
  document.getElementById(tabType + 'Pane').classList.add('active');
  currentFile = tabType;
  document.getElementById(tabType + 'Editor').value = files[tabType] || '';
  updateLineNumbers(tabType);
  updateStatus();
}

/* ===== save/load helpers ===== */
function saveCurrentFile(){ files[currentFile] = document.getElementById(currentFile + 'Editor').value; }
function loadFileContent(fileType){ document.getElementById(fileType + 'Editor').value = files[fileType] || ''; updateLineNumbers(fileType); }

/* ===== ì•ˆì „í•œ ìŠ¤í¬ë¦½íŠ¸ ë‹«ê¸° ì´ìŠ¤ì¼€ì´í”„ ===== */
function escapeClosingScriptTag(s){ return s.replace(/<\/script>/gi, '<\\/script>'); }

/* ===== ì•ˆì „í•œ HTML ë¹Œë“œ (DOMParser ì‚¬ìš©) ===== */
function buildFullHTML(){
  const source = files.html || '<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"></head><body></body></html>';
  const css = files.css || '';
  const js = files.js || '';

  const parser = new DOMParser();
  const doc = parser.parseFromString(source, 'text/html');

  if(!doc.head){
    const head = doc.createElement('head');
    doc.documentElement.insertBefore(head, doc.body || null);
  }

  // ì œê±°: ì™¸ë¶€ ìŠ¤íƒ€ì¼ì‹œíŠ¸ + ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸
  doc.querySelectorAll('link[rel="stylesheet"]').forEach(e => e.remove());
  doc.querySelectorAll('script[src]').forEach(e => e.remove());

  // ì¸ë¼ì¸ CSS ì¶”ê°€
  const styleEl = doc.createElement('style');
  styleEl.type = 'text/css';
  styleEl.textContent = css;
  doc.head.appendChild(styleEl);

  // ì¸ë¼ì¸ JS ì¶”ê°€ (ë‹«ëŠ” ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ ì´ìŠ¤ì¼€ì´í”„)
  const scriptEl = doc.createElement('script');
  scriptEl.type = 'text/javascript';
  scriptEl.textContent = escapeClosingScriptTag(js);
  (doc.body || doc.documentElement).appendChild(scriptEl);

  return '<!DOCTYPE html>\n' + doc.documentElement.outerHTML;
}

/* ===== ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ (Blob) ===== */
function updatePreview(){
  saveCurrentFile();
  const full = buildFullHTML();
  console.log('--- preview html (truncated) ---\n', full.slice(0, 4000)); // ë¬¸ì œ ì¶”ì ìš© (ê¸¸ë©´ ì˜ë¼ì„œ ë³´ì—¬ì¤Œ)
  const blob = new Blob([full], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const iframe = document.getElementById('previewFrame');
  iframe.src = url;
  setTimeout(()=> URL.revokeObjectURL(url), 1500);
}
function refreshPreview(){ updatePreview(); }
function openInNewTab(){ saveCurrentFile(); const url = URL.createObjectURL(new Blob([buildFullHTML()], {type:'text/html'})); window.open(url,'_blank'); setTimeout(()=>URL.revokeObjectURL(url),1500); }

/* ===== ì €ì¥(ë‹¤ìš´ë¡œë“œ) ===== */
function saveProject(){
  saveCurrentFile();
  const proj = { html: files.html, css: files.css, js: files.js, timestamp: new Date().toISOString() };
  const blob = new Blob([JSON.stringify(proj,null,2)], { type:'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='codehub-project.json'; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(url),1000);
}

/* ===== ê³µìœ (ë¬¸ìì—´) ===== */
function shareProject(){
  saveCurrentFile();
  try{
    const encoded = base64EncodeUnicode(JSON.stringify(files));
    // ë¡œì»¬ í™˜ê²½ì€ ë³µì‚¬ ì‹¤íŒ¨í•  ìˆ˜ ìˆìœ¼ë‹ˆ alertì™€ clipboard ë‘˜ ë‹¤ ì‹œë„
    navigator.clipboard?.writeText(encoded).then(()=>alert('í”„ë¡œì íŠ¸ ë¬¸ìì—´ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.\në¶™ì—¬ë„£ì–´ loadFromString(encoded)ë¡œ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.'), ()=>alert('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨ â€” ë¬¸ìì—´ì„ ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•˜ì„¸ìš”:\n\n' + encoded));
  }catch(e){ alert('ê³µìœ  ì‹¤íŒ¨: ' + e.message); }
}
function loadFromString(encoded){
  try {
    const obj = JSON.parse(base64DecodeUnicode(encoded));
    files = obj;
    document.getElementById('htmlEditor').value = files.html || '';
    document.getElementById('cssEditor').value = files.css || '';
    document.getElementById('jsEditor').value = files.js || '';
    updateLineNumbers('html'); updateLineNumbers('css'); updateLineNumbers('js');
    updatePreview();
  } catch(e){ alert('ë¡œë“œ ì‹¤íŒ¨: ì˜ëª»ëœ ë¬¸ìì—´'); }
}

/* ===== í…œí”Œë¦¿ ì•ˆì „í•˜ê²Œ ë¡œë“œ ===== */
function loadTemplate(type){
  const templates = {
    basic: {
      html: '<!DOCTYPE html><html lang="ko"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"><title>ê¸°ë³¸</title><link rel="stylesheet" href="style.css"></head><body><header><h1>ê¸°ë³¸ í˜ì´ì§€</h1></header><script src="script.js"><\/script></body></html>',
      css: 'body{font-family:Arial,sans-serif;margin:0;padding:0}header{background:#2c3e50;color:#fff;padding:1rem;text-align:center}',
      js: 'console.log(\"basic template loaded\")'
    },
    portfolio: {
      html: '<!DOCTYPE html><html lang="ko"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"><title>í¬íŠ¸í´ë¦¬ì˜¤</title><link rel="stylesheet" href="style.css"></head><body><section class=\"hero\"><h1>Portfolio</h1></section><script src=\"script.js\"><\/script></body></html>',
      css: 'body{font-family:Arial,sans-serif} .hero{height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}',
      js: 'console.log(\"portfolio loaded\")'
    },
    game: {
      html: '<!DOCTYPE html><html lang="ko"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"><title>Game</title><link rel="stylesheet" href="style.css"></head><body><canvas id=\"game\" width=\"800\" height=\"400\"></canvas><script src=\"script.js\"><\/script></body></html>',
      css: 'body{margin:0;background:#111;color:#fff}canvas{display:block;margin:20px auto;background:#000;border:3px solid #444}',
      js: 'const c=document.getElementById(\"game\");if(c){const g=c.getContext(\"2d\");g.fillStyle=\"#fff\";g.fillRect(20,20,60,60)}'
    }
  };

  if(templates[type]){
    files.html = templates[type].html;
    files.css  = templates[type].css;
    files.js   = templates[type].js;
    document.getElementById('htmlEditor').value = files.html;
    document.getElementById('cssEditor').value = files.css;
    document.getElementById('jsEditor').value = files.js;
    updateLineNumbers('html'); updateLineNumbers('css'); updateLineNumbers('js');
    updatePreview();
  } else alert('í…œí”Œë¦¿ ì—†ìŒ');
}

/* ===== ìƒˆ íŒŒì¼(ê°„ë‹¨ ì²˜ë¦¬) ===== */
function addNewFile(){
  const t = prompt('ìƒˆ íŒŒì¼ ìœ í˜• ì…ë ¥ (html / css / js)', 'html');
  if(!t) return;
  if(!['html','css','js'].includes(t)){ alert('ì§€ì›ë˜ì§€ ì•ŠìŒ'); return; }
  switchTab(t);
}

/* ===== ì‹¤í–‰ ë²„íŠ¼ ===== */
function runCode(){ updatePreview(); }

/* ===== URLì—ì„œ ê³µìœ  ë¬¸ìì—´ë¡œ ë¡œë“œ ì‹œë„ ===== */
(function(){
  const params = new URLSearchParams(location.search);
  const p = params.get('project');
  if(p){
    try { loadFromString(p); } catch(e) { console.warn('URL load failed', e); updatePreview(); }
  } else updatePreview();
})();

/* ===== ìƒíƒœë°” ===== */
function updateStatus(){ const lines = document.getElementById(currentFile + 'Editor').value.split('\n').length; document.getElementById('statusInfo').textContent = currentFile.toUpperCase() + ' | ë¼ì¸ ' + lines; }

/* ì´ˆê¸°í™” */
updateLineNumbers('html'); updateLineNumbers('css'); updateLineNumbers('js');
updateStatus();
</script>
</body>
</html>
